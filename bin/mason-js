#!/usr/bin/env node
var loader = require('../lib/retrieve_package.js');
var sym = require('../lib/symlink.js');
var log = require('npmlog');
var fse = require('fs-extra');
var fs = require('fs');
var path = require('path');

global.appRoot = process.cwd();
var masonPath = global.appRoot + '/mason-versions.ini';

const filterFunc = (src, dest) => {
  if (src.indexOf(".hpp")> -1 || src.indexOf(".h")> -1 ){
    if(fs.existsSync(dest)){
      fs.unlinkSync(dest);
    }
    fs.symlinkSync(src,dest);
    return false;
  }else{
    return true;
  }
}

loader.install(masonPath, function(err, result){
  if (err) throw err; 
  log.info('Mason Package Install Starting');

  sym.buildLinkPaths(function(err, symLinkPaths){
    log.info('Creating Symlinks');
    symLinkPaths.forEach(function(p){
      var src = p[0];
      var dst = p[1];
      fse.copySync(src, dst, { clobber: true, filter:filterFunc });
    }); 
  });
});








