#!/usr/bin/env node
let fileReaderPromise = require('../lib/ini_file_reader.js');
var test = require('tape');
var packageLoader = require('../lib/retrieve_package.js');
const fs = require('fs');
const dotenvConfig = require('../config.js');
dotenvConfig.envConfig();
const path = require('path');
const appDir = process.cwd();
const mkdirp = require('mkdirp');
var headerPackagePath; 

fileReaderPromise.then(function(packageList) {
  packageList.forEach(function(r){

      var src = process.env.MASON_BUCKET+r.awsPath;
      var dst = path.join(appDir,'mason_packages', r.awsPath);
      console.log(src);
      mkdirp(dst,function(err) {
          if (err) {
              after_place(err);
          } else {
              packageLoader.place_binary(src, dst, function(err, response){
                if (err) throw err; 
                // console.log(err);
                // console.log(result);
              });
          }
      }); 
  })
  // download header only libraries
  // download compiled libraries 
}).catch(error => console.log(error)); 


// .then(packageloader.generatePackageUrl)

// let packageData ={'name':'protozero', 'version':'1.5.1', 'headers':true};
// packageLoader.generatePackageUrl(packageData, function(err, url) {
//   console.log(err);
//   console.log(url);
//   download(url, function(err, result){
//     console.log(result);
//   })
// });